[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "统计数据分析及可视化(讲义)",
    "section": "",
    "text": "目录\n\nTidy数据处理框架\n\nR base\nR Tidy\nggplot\n\n统计数据分析\n\n参数估计\n假设检验\n回归分析\n\n可视化\n\n案例1：商业数据分析\n案例2：体育数据分析",
    "crumbs": [
      "目录"
    ]
  },
  {
    "objectID": "data.html",
    "href": "data.html",
    "title": "2  数据操作",
    "section": "",
    "text": "2.1 管道函数\nx = runif(100, 1, 5)\nsqrt(mean(x))\n\n[1] 1.688498\nx  %&gt;%  mean  %&gt;% sqrt\n\n[1] 1.688498\n非管道操作\nmean(mpg[mpg$drv==\"f\",]$hwy)\n\n[1] 28.16038\n\nmean(mpg[mpg$drv==\"4\",]$hwy)\n\n[1] 19.17476\n\nmean(mpg[mpg$drv==\"r\",]$hwy)\n\n[1] 21\nlevelValue = levels(factor(mpg$drv))\naveVec = rep(0, length(levelValue))\nfor(i in 1:length(levelValue)){\n  aveVec[i] = mean(mpg[mpg$drv==levelValue[i],]$hwy)\n}\naveVec = tapply(mpg$hwy, INDEX = mpg$drv, FUN = mean)\naveVec\n\n       4        f        r \n19.17476 28.16038 21.00000\n管道操作\nd1 &lt;- mpg %&gt;%  \ngroup_by(drv)\nd1\n\n# A tibble: 234 × 11\n# Groups:   drv [3]\n   manufacturer model      displ  year   cyl trans drv     cty   hwy fl    class\n   &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;\n 1 audi         a4           1.8  1999     4 auto… f        18    29 p     comp…\n 2 audi         a4           1.8  1999     4 manu… f        21    29 p     comp…\n 3 audi         a4           2    2008     4 manu… f        20    31 p     comp…\n 4 audi         a4           2    2008     4 auto… f        21    30 p     comp…\n 5 audi         a4           2.8  1999     6 auto… f        16    26 p     comp…\n 6 audi         a4           2.8  1999     6 manu… f        18    26 p     comp…\n 7 audi         a4           3.1  2008     6 auto… f        18    27 p     comp…\n 8 audi         a4 quattro   1.8  1999     4 manu… 4        18    26 p     comp…\n 9 audi         a4 quattro   1.8  1999     4 auto… 4        16    25 p     comp…\n10 audi         a4 quattro   2    2008     4 manu… 4        20    28 p     comp…\n# ℹ 224 more rows\n\nd1 %&gt;% \nsummarise(hwy_ave = mean(hwy))\n\n# A tibble: 3 × 2\n  drv   hwy_ave\n  &lt;chr&gt;   &lt;dbl&gt;\n1 4        19.2\n2 f        28.2\n3 r        21",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>数据操作</span>"
    ]
  },
  {
    "objectID": "data.html#管道函数",
    "href": "data.html#管道函数",
    "title": "2  数据操作",
    "section": "",
    "text": "mpg数据集，以drv变量分组，统计hwy的均值\n\n\n\n一般流程\n\n\n\n如果有很多组怎么办\n\n\n\nbase 里面的分组统计操作\n\n\n\n\n\n2.1.1 管道函数非第一参数\n\nmpg %&gt;% \ngroup_split(drv)  %&gt;% \nmap(~mean(.x$hwy))\n\n[[1]]\n[1] 19.17476\n\n[[2]]\n[1] 28.16038\n\n[[3]]\n[1] 21\n\n\n\n.可以在当层管道中多次使用，但是要放在{}环境中\n\n\nx = c(n = 10, m = 5, lambda = 2)\n\n从\\(x\\)出发，生成\\(n\\)个参数为\\(\\lambda\\)的指数分布随机数\n错误用法\n\nx  %&gt;% \nrexp(.[1],.[3])\n\n正确用法\n\nx  %&gt;% \n{rexp(.[1],.[3])}\n\n [1] 0.032719728 0.022050870 0.328391346 0.375925978 0.747117515 0.149204943\n [7] 0.397651518 0.603256682 1.099610054 0.001865421\n\n\n\nx  %&gt;% \n {list(rnum = rexp(.[1], .[3]), m = .[2])}  %&gt;% \n {.$rnum[1:.$m]}\n\n[1] 0.13969607 0.08017244 0.58625885 0.25134195 0.13387646\n\n\n\nmap循环机制\n\n计算mpg数据集hwy与cty两个变量的均值\n\nmpg1 &lt;- mpg[,c(\"hwy\",\"cty\")]\nmpg1  %&gt;% \nmap(mean)\n\n$hwy\n[1] 23.44017\n\n$cty\n[1] 16.85897\n\n\n可以控制返回值的类型\n\nmpg1  %&gt;% \nmap_dbl(mean)\n\n     hwy      cty \n23.44017 16.85897 \n\n\n\nmap2_dbl(iris[,1], iris[,2], ~.x + .y)\n\n  [1]  8.6  7.9  7.9  7.7  8.6  9.3  8.0  8.4  7.3  8.0  9.1  8.2  7.8  7.3  9.8\n [16] 10.1  9.3  8.6  9.5  8.9  8.8  8.8  8.2  8.4  8.2  8.0  8.4  8.7  8.6  7.9\n [31]  7.9  8.8  9.3  9.7  8.0  8.2  9.0  8.5  7.4  8.5  8.5  6.8  7.6  8.5  8.9\n [46]  7.8  8.9  7.8  9.0  8.3 10.2  9.6 10.0  7.8  9.3  8.5  9.6  7.3  9.5  7.9\n [61]  7.0  8.9  8.2  9.0  8.5  9.8  8.6  8.5  8.4  8.1  9.1  8.9  8.8  8.9  9.3\n [76]  9.6  9.6  9.7  8.9  8.3  7.9  7.9  8.5  8.7  8.4  9.4  9.8  8.6  8.6  8.0\n [91]  8.1  9.1  8.4  7.3  8.3  8.7  8.6  9.1  7.6  8.5  9.6  8.5 10.1  9.2  9.5\n[106] 10.6  7.4 10.2  9.2 10.8  9.7  9.1  9.8  8.2  8.6  9.6  9.5 11.5 10.3  8.2\n[121] 10.1  8.4 10.5  9.0 10.0 10.4  9.0  9.1  9.2 10.2 10.2 11.7  9.2  9.1  8.7\n[136] 10.7  9.7  9.5  9.0 10.0  9.8 10.0  8.5 10.0 10.0  9.7  8.8  9.5  9.6  8.9\n\n\n将mpg数据集按drv变量进行分组，然后统计各组hwy的均值\n\nmpg %&gt;% \ngroup_split(drv)  %&gt;% \nmap(mean)\n\nWarning in mean.default(.x[[i]], ...): 参数不是数值也不是逻辑值：回覆NA\n\nWarning in mean.default(.x[[i]], ...): 参数不是数值也不是逻辑值：回覆NA\n\nWarning in mean.default(.x[[i]], ...): 参数不是数值也不是逻辑值：回覆NA\n\n\n[[1]]\n[1] NA\n\n[[2]]\n[1] NA\n\n[[3]]\n[1] NA\n\n\n将mpg数据集按drv变量进行分组，然后画出各组displ与hwy的散点图\n\nmpg %&gt;% \ngroup_split(drv)  %&gt;% \nmap(~plot(.x$displ, .x$hwy))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[[1]]\nNULL\n\n[[2]]\nNULL\n\n[[3]]\nNULL\n\n\n\nplotfun &lt;- function(xx){\n  p1 &lt;- ggplot(data = xx, aes(x = displ, y  = hwy)) +\n  geom_point()\n  p1\n}\nmpg %&gt;% \ngroup_split(drv)  %&gt;% \nmap(plotfun)\n\n[[1]]\n\n\n\n\n\n\n\n\n\n\n[[2]]\n\n\n\n\n\n\n\n\n\n\n[[3]]\n\n\n\n\n\n\n\n\n\n使用匿名函数\n\nmpg %&gt;% \ngroup_split(drv)  %&gt;% \nmap(~ggplot(.x, aes(x = displ, y = hwy)))\n\n[[1]]\n\n\n\n\n\n\n\n\n\n\n[[2]]\n\n\n\n\n\n\n\n\n\n\n[[3]]",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>数据操作</span>"
    ]
  },
  {
    "objectID": "data.html#数据变换",
    "href": "data.html#数据变换",
    "title": "2  数据操作",
    "section": "2.2 数据变换",
    "text": "2.2 数据变换\nmutate增加列\n\niris %&gt;% \n  mutate(Sepal.LW = Sepal.Length+Sepal.Width) %&gt;% \n  head(5)\n\n  Sepal.Length Sepal.Width Petal.Length Petal.Width Species Sepal.LW\n1          5.1         3.5          1.4         0.2  setosa      8.6\n2          4.9         3.0          1.4         0.2  setosa      7.9\n3          4.7         3.2          1.3         0.2  setosa      7.9\n4          4.6         3.1          1.5         0.2  setosa      7.7\n5          5.0         3.6          1.4         0.2  setosa      8.6",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>数据操作</span>"
    ]
  },
  {
    "objectID": "data.html#分组统计",
    "href": "data.html#分组统计",
    "title": "2  数据操作",
    "section": "2.3 分组统计",
    "text": "2.3 分组统计\n\nmpg  %&gt;% \ngroup_by(drv)  %&gt;% \nsummarise(meanHwy = mean(hwy))\n\n# A tibble: 3 × 2\n  drv   meanHwy\n  &lt;chr&gt;   &lt;dbl&gt;\n1 4        19.2\n2 f        28.2\n3 r        21  \n\n\n\nmpg  %&gt;% \ngroup_by(drv)  %&gt;% \nsummarise(NumbyDrv = n())\n\n# A tibble: 3 × 2\n  drv   NumbyDrv\n  &lt;chr&gt;    &lt;int&gt;\n1 4          103\n2 f          106\n3 r           25\n\n\n\nmpg  %&gt;% \ngroup_split(drv) %&gt;% \nmap(~mean(.x$hwy))\n\n[[1]]\n[1] 19.17476\n\n[[2]]\n[1] 28.16038\n\n[[3]]\n[1] 21\n\n\n\nmpg  %&gt;% \ngroup_split(drv) %&gt;% \nmap_dbl(~length(.x$hwy))\n\n[1] 103 106  25",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>数据操作</span>"
    ]
  },
  {
    "objectID": "data.html#filter函数",
    "href": "data.html#filter函数",
    "title": "2  数据操作",
    "section": "2.4 filter函数",
    "text": "2.4 filter函数\nmpg数据以drv分组，找到各组数据hwy值大于均值+标准差的样本\n\n体会group_by与group_split的区别\n\n\nmpg  %&gt;% \ngroup_by(drv)  %&gt;% \nfilter(hwy &gt; mean(hwy)+sd(hwy))\n\n# A tibble: 40 × 11\n# Groups:   drv [3]\n   manufacturer model      displ  year   cyl trans drv     cty   hwy fl    class\n   &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;\n 1 audi         a4 quattro   1.8  1999     4 manu… 4        18    26 p     comp…\n 2 audi         a4 quattro   1.8  1999     4 auto… 4        16    25 p     comp…\n 3 audi         a4 quattro   2    2008     4 manu… 4        20    28 p     comp…\n 4 audi         a4 quattro   2    2008     4 auto… 4        19    27 p     comp…\n 5 audi         a4 quattro   2.8  1999     6 auto… 4        15    25 p     comp…\n 6 audi         a4 quattro   2.8  1999     6 manu… 4        17    25 p     comp…\n 7 audi         a4 quattro   3.1  2008     6 auto… 4        17    25 p     comp…\n 8 audi         a4 quattro   3.1  2008     6 manu… 4        15    25 p     comp…\n 9 audi         a6 quattro   2.8  1999     6 auto… 4        15    24 p     mids…\n10 audi         a6 quattro   3.1  2008     6 auto… 4        17    25 p     mids…\n# ℹ 30 more rows\n\n\n\nmpg  %&gt;% \ngroup_split(drv) %&gt;% \nmap(~filter(.x, hwy &gt;mean(hwy)+sd(hwy)))\n\n[[1]]\n# A tibble: 23 × 11\n   manufacturer model      displ  year   cyl trans drv     cty   hwy fl    class\n   &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;\n 1 audi         a4 quattro   1.8  1999     4 manu… 4        18    26 p     comp…\n 2 audi         a4 quattro   1.8  1999     4 auto… 4        16    25 p     comp…\n 3 audi         a4 quattro   2    2008     4 manu… 4        20    28 p     comp…\n 4 audi         a4 quattro   2    2008     4 auto… 4        19    27 p     comp…\n 5 audi         a4 quattro   2.8  1999     6 auto… 4        15    25 p     comp…\n 6 audi         a4 quattro   2.8  1999     6 manu… 4        17    25 p     comp…\n 7 audi         a4 quattro   3.1  2008     6 auto… 4        17    25 p     comp…\n 8 audi         a4 quattro   3.1  2008     6 manu… 4        15    25 p     comp…\n 9 audi         a6 quattro   2.8  1999     6 auto… 4        15    24 p     mids…\n10 audi         a6 quattro   3.1  2008     6 auto… 4        17    25 p     mids…\n# ℹ 13 more rows\n\n[[2]]\n# A tibble: 11 × 11\n   manufacturer model      displ  year   cyl trans drv     cty   hwy fl    class\n   &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;\n 1 honda        civic        1.6  1999     4 manu… f        28    33 r     subc…\n 2 honda        civic        1.8  2008     4 manu… f        26    34 r     subc…\n 3 honda        civic        1.8  2008     4 auto… f        25    36 r     subc…\n 4 honda        civic        1.8  2008     4 auto… f        24    36 c     subc…\n 5 toyota       corolla      1.8  1999     4 auto… f        24    33 r     comp…\n 6 toyota       corolla      1.8  1999     4 manu… f        26    35 r     comp…\n 7 toyota       corolla      1.8  2008     4 manu… f        28    37 r     comp…\n 8 toyota       corolla      1.8  2008     4 auto… f        26    35 r     comp…\n 9 volkswagen   jetta        1.9  1999     4 manu… f        33    44 d     comp…\n10 volkswagen   new beetle   1.9  1999     4 manu… f        35    44 d     subc…\n11 volkswagen   new beetle   1.9  1999     4 auto… f        29    41 d     subc…\n\n[[3]]\n# A tibble: 6 × 11\n  manufacturer model    displ  year   cyl trans    drv     cty   hwy fl    class\n  &lt;chr&gt;        &lt;chr&gt;    &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;\n1 chevrolet    corvette   5.7  1999     8 manual(… r        16    26 p     2sea…\n2 chevrolet    corvette   6.2  2008     8 manual(… r        16    26 p     2sea…\n3 chevrolet    corvette   6.2  2008     8 auto(s6) r        15    25 p     2sea…\n4 ford         mustang    3.8  1999     6 manual(… r        18    26 r     subc…\n5 ford         mustang    3.8  1999     6 auto(l4) r        18    25 r     subc…\n6 ford         mustang    4    2008     6 manual(… r        17    26 r     subc…\n\n\n\nmpg  %&gt;% \ngroup_split(drv) %&gt;% \nmap(~filter(.x, .x$hwy &gt;mean(.x$hwy)+sd(.x$hwy)))\n\n[[1]]\n# A tibble: 23 × 11\n   manufacturer model      displ  year   cyl trans drv     cty   hwy fl    class\n   &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;\n 1 audi         a4 quattro   1.8  1999     4 manu… 4        18    26 p     comp…\n 2 audi         a4 quattro   1.8  1999     4 auto… 4        16    25 p     comp…\n 3 audi         a4 quattro   2    2008     4 manu… 4        20    28 p     comp…\n 4 audi         a4 quattro   2    2008     4 auto… 4        19    27 p     comp…\n 5 audi         a4 quattro   2.8  1999     6 auto… 4        15    25 p     comp…\n 6 audi         a4 quattro   2.8  1999     6 manu… 4        17    25 p     comp…\n 7 audi         a4 quattro   3.1  2008     6 auto… 4        17    25 p     comp…\n 8 audi         a4 quattro   3.1  2008     6 manu… 4        15    25 p     comp…\n 9 audi         a6 quattro   2.8  1999     6 auto… 4        15    24 p     mids…\n10 audi         a6 quattro   3.1  2008     6 auto… 4        17    25 p     mids…\n# ℹ 13 more rows\n\n[[2]]\n# A tibble: 11 × 11\n   manufacturer model      displ  year   cyl trans drv     cty   hwy fl    class\n   &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;\n 1 honda        civic        1.6  1999     4 manu… f        28    33 r     subc…\n 2 honda        civic        1.8  2008     4 manu… f        26    34 r     subc…\n 3 honda        civic        1.8  2008     4 auto… f        25    36 r     subc…\n 4 honda        civic        1.8  2008     4 auto… f        24    36 c     subc…\n 5 toyota       corolla      1.8  1999     4 auto… f        24    33 r     comp…\n 6 toyota       corolla      1.8  1999     4 manu… f        26    35 r     comp…\n 7 toyota       corolla      1.8  2008     4 manu… f        28    37 r     comp…\n 8 toyota       corolla      1.8  2008     4 auto… f        26    35 r     comp…\n 9 volkswagen   jetta        1.9  1999     4 manu… f        33    44 d     comp…\n10 volkswagen   new beetle   1.9  1999     4 manu… f        35    44 d     subc…\n11 volkswagen   new beetle   1.9  1999     4 auto… f        29    41 d     subc…\n\n[[3]]\n# A tibble: 6 × 11\n  manufacturer model    displ  year   cyl trans    drv     cty   hwy fl    class\n  &lt;chr&gt;        &lt;chr&gt;    &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;\n1 chevrolet    corvette   5.7  1999     8 manual(… r        16    26 p     2sea…\n2 chevrolet    corvette   6.2  2008     8 manual(… r        16    26 p     2sea…\n3 chevrolet    corvette   6.2  2008     8 auto(s6) r        15    25 p     2sea…\n4 ford         mustang    3.8  1999     6 manual(… r        18    26 r     subc…\n5 ford         mustang    3.8  1999     6 auto(l4) r        18    25 r     subc…\n6 ford         mustang    4    2008     6 manual(… r        17    26 r     subc…",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>数据操作</span>"
    ]
  },
  {
    "objectID": "ggplot2.html",
    "href": "ggplot2.html",
    "title": "3  ggplot2 画图系统",
    "section": "",
    "text": "3.1 分组\n分组操作：aes(color = drv)\nlibrary(tidyverse)\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.3     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.0\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nggplot(data = mpg, aes(x = displ, y = hwy, color = drv)) + \ngeom_point()\n对color的操作可以放到geom_point中\nggplot(data = mpg, aes(x = displ, y = hwy)) + \ngeom_point(aes(color = drv))\nggplot(data = mpg, aes(x = displ, y = hwy,color = drv)) + \ngeom_point() +\ngeom_smooth()\n\n`geom_smooth()` using method = 'loess' and formula = 'y ~ x'\nggplot(data = mpg, aes(x = displ, y = hwy)) + \ngeom_point(aes(color = drv)) +\ngeom_smooth()\n\n`geom_smooth()` using method = 'loess' and formula = 'y ~ x'\nggplot(data = mpg, aes(x = displ, y = hwy, color = class)) + \ngeom_point(aes(color = drv)) +\ngeom_smooth()\n\n`geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n几何对象ggplot2绘图系统中全局与局部的规定\n例：针对分省数据绘制人均GDP与年份之间的折线图，每个年份都对应31个省份人均GDP值\nload(\"../slides2024/Lecture2/data/ecostats.rda\")\necostats\n\n# A tibble: 527 × 7\n   Region  Year Electricity Investment Consumption Population gdpPercap\n   &lt;chr&gt;  &lt;int&gt;       &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;\n 1 安徽    2001       360.        893.        2739       6128     5716.\n 2 北京    2001       400.       1513.        9057       1385    27881.\n 3 福建    2001       439.       1173.        4770       3445    11823.\n 4 甘肃    2001       306.        460.        2099       2523     4461.\n 5 广东    2001      1458.       3484.        5445       8733    13886.\n 6 广西    2001       332.        656.        2572       4788     4760.\n 7 贵州    2001       335.        536.        2178       3799     2983.\n 8 海南    2001        43.0       213.        2971        796     7276.\n 9 河北    2001       868.       1913.        2749       6699     7558.\n10 河南    2001       808.       1544.        2381       9555     5791.\n# ℹ 517 more rows\nggplot(data = ecostats, aes(x = Year, y = gdpPercap)) + \ngeom_line()\nggplot(data = ecostats, aes(x = Year, y = gdpPercap)) + \ngeom_line(aes(color = Region))\nggplot(data = ecostats, aes(x = Year, y = gdpPercap)) + \ngeom_line(aes(color = Region)) + \ngeom_smooth()\n\n`geom_smooth()` using method = 'loess' and formula = 'y ~ x'\nggplot(data = ecostats, aes(x = Year, y = gdpPercap,color = Region)) + \ngeom_line() + \ngeom_smooth()\n\n`geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n分组图形特征映射\nggplot(data = ecostats, aes(x = Year, y = gdpPercap)) + \ngeom_line(aes(group = Region), alpha = 0.2)\nggplot(data = ecostats, aes(x = Year, y = gdpPercap, group=Region)) + \ngeom_line(alpha = 0.2)",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>ggplot2 画图系统</span>"
    ]
  },
  {
    "objectID": "ggplot2.html#分组",
    "href": "ggplot2.html#分组",
    "title": "3  ggplot2 画图系统",
    "section": "",
    "text": "将颜色映射到分类变量drv\n对不同drv值的数据，按不同颜色分别绘图\n\n\n\n\n\n分析区别\n\n\n\n\n\n\nggplot()中的数据和映射是全局的，可供所有几何对象共用\n位于几何对象中的数据和映射，是局部的，只供该几何对象使用\n几何对象优先使用局部的，局部没有则用全局的\n\n\n\n\n\n用分组操作实现对不同省分的变量情况刻画\n\n\n\n添加平滑线",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>ggplot2 画图系统</span>"
    ]
  },
  {
    "objectID": "ggplot2.html#标度",
    "href": "ggplot2.html#标度",
    "title": "3  ggplot2 画图系统",
    "section": "3.2 标度",
    "text": "3.2 标度\n\n3.2.1 修改坐标轴标签\n\nggplot(data = mpg, aes(x = displ, y = hwy)) + \ngeom_point() +\nscale_y_continuous(breaks = seq(10,50,by=20), labels = letters[1:3])\n\n\n\n\n\n\n\n\n\n思考：为什么上面的图只显示了字母b?\n\n\np &lt;- ggplot(tail(economics,45), aes(date, uempmed/100)) + \ngeom_line()+\nscale_x_date(date_breaks = \"6 months\", date_labels = \"%b%Y\") +\nscale_y_continuous(labels = scales::percent)\n\n\n\n3.2.2 修改坐标轴名称\n\np1 &lt;- ggplot(data = mpg, aes(x = displ, y = hwy))\np2 &lt;- p1 + geom_point()\np2\n\n\n\n\n\n\n\n\n\np2 + \ngeom_point(aes(color = drv), shape = 2)\n\n\n\n\n\n\n\n\n\np1 + \ngeom_point(aes(color = drv), shape = 2)\n\n\n\n\n\n\n\n\n\np1 &lt;- p + \nlabs(x = \"Month\", y = \"Unemployed rate\")\np1\n\n\n\n\n\n\n\n\n\np2 &lt;- p + \nxlab(\"Month\") +\nylab(\"Unemployed rate\")\np2 \n\n\n\n\n\n\n\n\n\npMpg = ggplot(data = mpg, aes(x = displ, y = hwy)) \np1 = pMpg + geom_point(aes(color = drv))\np1 \n\n\n\n\n\n\n\n\n\n若前面已使用 color 参数，则可以在 labs() 函数中使用参数color 修改颜色的图例名称\n\n\np2 = p1 + \nlabs(color = \"驱动方式\") + \ntheme(legend.position = \"top\")\np2\n\n\n\n\n\n\n\n\n\n\n3.2.3 设置坐标轴范围\n\ncoord_cartesian命令\n笛卡尔坐标系就是直角坐标系和斜角坐标系的统称\n\n\nggplot(data = mpg, aes(x = displ, y = hwy)) + \ngeom_point() +\nscale_y_continuous(breaks = seq(10,50,by=20), labels = letters[1:3])+\ncoord_cartesian(ylim = c(0,50))\n\n\n\n\n\n\n\n\nylim后不能显示scale设置的breaks点的label\n\nggplot(data = mpg, aes(x = displ, y = hwy)) + \ngeom_point() +\nscale_y_continuous(breaks = seq(10,50,by=20), labels = letters[1:3])+\nylim(0,50) \n\nScale for y is already present.\nAdding another scale for y, which will replace the existing scale.\n\n\n\n\n\n\n\n\n\n\n体会一下scale与ylim设置顺序的不同，结果的不同\n\n\nggplot(data = mpg, aes(x = displ, y = hwy)) + \ngeom_point() +\ncoord_cartesian(ylim = c(0,50))+\nscale_y_continuous(breaks = seq(10,50,by=20), labels = letters[1:3])\n\n\n\n\n\n\n\n\n\nggplot(data = mpg, aes(x = displ, y = hwy)) + \ngeom_point() +\nylim(0,50) +  \nscale_y_continuous(breaks = seq(10,50,by=20), labels = letters[1:3])\n\nScale for y is already present.\nAdding another scale for y, which will replace the existing scale.\n\n\n\n\n\n\n\n\n\n\n\n3.2.4 变换\n\nn=100\nx=rnorm(n,4,1)\ny=10^(5*log10(x)+8)+rnorm(n,1,2)\n\n\n画散点图\n\n\ndataxy = tibble(x,y)\np1 &lt;- ggplot(data = dataxy, aes(x,y)) + \ngeom_point()\n\n对数变换之后作散点图\n\np2 &lt;- p1 + \nscale_x_log10() +\nscale_y_log10() \np2\n\n\n\n\n\n\n\n\n\n使用自定义的函数会报错\n\n\nmylog &lt;- function(x){\n  return(log10(x))\n}\n\n\np2 &lt;- p1 + \nscale_x_mylog() +\nscale_y_mylog() \np2\n\n进行回归分析\n\np2 &lt;- p1 + \nscale_x_log10() +\nscale_y_log10() +\ngeom_smooth()\np2\n\n`geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n\n\n\n\n\n\n\n\n\n\n\n3.2.5 设置图形标题与副标题\n\np2 +\nlabs(title = \"回归分析\",\nsubtitle = \"对数\",\ncaption = \"数据随机模拟产生\")\n\n`geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n\n\n\n\n\n\n\n\n\n\n\n3.2.6 颜色配置\n\np1 &lt;- ggplot(data = mpg, aes(x = displ, y = hwy, color = drv)) +\ngeom_point() +\nlabs(color = \"驱动方式\")\np1\n\n\n\n\n\n\n\n\n\np1 +\nscale_color_manual(\"驱动方式1\", \nvalues = c(\"red\", \"blue\", \"green\"),\nlabels = c(\"4\", \"f\", \"r\"))\n\n\n\n\n\n\n\n\n按什么顺序排的颜色？\n\np1 +\nscale_color_manual(\"驱动方式2\", \nbreaks = c(\"f\", \"r\", \"4\"),\nvalues = c(\"red\", \"blue\", \"green\"),\nlabels = c(\"front\", \"rear\", \"four\"))\n\n\n\n\n\n\n\n\n\np1 +\nscale_color_manual(\"驱动方式3\", \nbreaks = c(\"f\", \"4\", \"r\"),\nvalues = c(\"blue\", \"red\", \"green\"),\nlabels = c(\"front\", \"four\", \"rear\"))\n\n\n\n\n\n\n\n\n\n\n3.2.7 文字标注\n\n从不同的drv中随机选一个，作标注\n\n\np1&lt;-ggplot(mpg,aes(displ, hwy))+geom_point(aes(color = drv))\np1\n\n\n\n\n\n\n\n\n\nlibrary(ggrepel)\nid1 = sample(which(mpg$drv==\"r\"),1)\nid2 = sample(which(mpg$drv==\"f\"),1)\nid3 = sample(which(mpg$drv==\"4\"),1)\ndataMark = mpg[c(id1,id2,id3),]\np1 +\ngeom_label_repel(data = dataMark, aes(label = drv))\n\n\n\n\n\n\n\n\n\n从不同drv中选取hwy最大的进行标注\n\n\nmaxValueR = max(mpg[which(mpg$drv==\"r\"),]$hwy)\nmaxValueF = max(mpg[which(mpg$drv==\"f\"),]$hwy)\nmaxValue4 = max(mpg[which(mpg$drv==\"4\"),]$hwy)\nid1 = which(mpg$drv==\"r\" & mpg$hwy == maxValueR) \nid2 = which(mpg$drv==\"f\" & mpg$hwy == maxValueF) \nid3 = which(mpg$drv==\"4\" & mpg$hwy == maxValue4) \ndataMark = mpg[c(id1,id2,id3),]\np1 +\ngeom_label_repel(data = dataMark, aes(label = drv))\n\n\n\n\n\n\n\n\n利用分组统计操作\n\nlibrary(magrittr)\n\n\n载入程辑包：'magrittr'\n\n\nThe following object is masked from 'package:purrr':\n\n    set_names\n\n\nThe following object is masked from 'package:tidyr':\n\n    extract\n\nbest_in_drv=mpg %&gt;%\ngroup_by(drv)%&gt;%\nslice_max(hwy,n =1)\np1 +\ngeom_label_repel(data = best_in_drv, aes(label = drv))\n\n\n\n\n\n\n\n\n\np1+\ngeom_text_repel(data =best_in_drv, aes(label= drv))\n\n\n\n\n\n\n\n\n注意映射与赋值的区别\n\np1+\ngeom_text_repel(data =best_in_drv, label= \"max\")\n\n\n\n\n\n\n\n\n\n\n3.2.8 统计变换\n以drv为横轴，对hwy数据进行汇总\n画出每个drv对应的均值\n\np1 &lt;- ggplot(data = mpg, aes(x = drv, y = hwy)) \np2 &lt;- p1 + \nstat_summary(fun.data = mean_se, geom = \"bar\", aes(color = drv, fill = drv))\np2\n\n\n\n\n\n\n\n\n\nfun.data参数可以省略，默认参数是mean_se\n\n画出每个drv的误差线\n\np3 &lt;- p1 + \nstat_summary(fun.data = mean_se, geom = \"errorbar\")\np3\n\n\n\n\n\n\n\n\n参数fun.data\n\n将数据变形，这个函数默认是mean_se()\n返回的是数据框，这个数据框将用于geom参数画图\n如果fun.data返回的数据框包含了所需要的美学映射，图形就会显示出来\n\n将柱状图与误差线放到一起\n\np1 +\nstat_summary(fun = mean, geom = \"bar\", aes(color = drv, fill = drv)) +\nstat_summary(fun.data = mean_se, geom = \"errorbar\") \n\n\n\n\n\n\n\n\n95%置信区间\n\np1 +\nstat_summary(fun = mean, geom = \"bar\", aes(color = drv, fill = drv)) +\nstat_summary(fun.data = ~mean_se(., mult = 1.96), geom = \"errorbar\") \n\n\n\n\n\n\n\n\n\n箱线图\n\n\np1  + \nstat_boxplot(geom = \"boxplot\", aes(color = drv))\n\n\n\n\n\n\n\n\n\n可在几何对象函数geom_*()中直接创建\n\n\np1 + \ngeom_boxplot(aes(color = drv))\n\n\n\n\n\n\n\n\n\np1 + \ngeom_boxplot(aes(color = drv)) + \nstat_summary(fun.data = ~mean_se(., mult = 1.96), geom = \"errorbar\") \n\n\n\n\n\n\n\n\n\n\n3.2.9 坐标系\n\n坐标轴翻转\n\n\np1 + \ngeom_boxplot(aes(color = drv)) + \nstat_summary(fun.data = ~mean_se(., mult = 1.96), geom = \"errorbar\") +\ncoord_flip()",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>ggplot2 画图系统</span>"
    ]
  },
  {
    "objectID": "case1.html",
    "href": "case1.html",
    "title": "4  案例: 钻石数据集分析",
    "section": "",
    "text": "4.1 度量carat与price之间的关系\ndiamonds  %&gt;% \nggplot(aes(x = carat, y = price)) +\ngeom_hex()\ndiamonds  %&gt;% \nfilter(carat&lt;2.5) %&gt;% \nggplot(aes(x = carat, y = price)) +\ngeom_hex() +\ngeom_smooth()\n\n`geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = \"cs\")'\ndiamondsNew  &lt;- diamonds  %&gt;% \nfilter(carat &lt; 2.5)  %&gt;% \nmutate(lcarat = log2(carat), lprice = log2(price))\ndiamondsNew %&gt;% \nggplot(aes(x = lcarat, y = lprice)) +\ngeom_hex()\nmodellm &lt;- lm(lprice~lcarat, data = diamondsNew)\nlibrary(modelr)\ngrid &lt;- diamondsNew  %&gt;% \ndata_grid(carat = seq_range(carat, 20))  %&gt;%   \nmutate(lcarat = log2(carat))  %&gt;% \nadd_predictions(modellm, \"lprice\")  %&gt;% \nmutate(pricePred = 2^lprice)\nggplot(diamondsNew, aes(x = carat, y = price)) + \ngeom_point() +\ngeom_line(data = grid, aes(x = carat, y = pricePred), col = \"red\")\n残差分析\ndiamondsNew &lt;- diamondsNew  %&gt;% \nadd_residuals(modellm, \"lresid\")  \n\nggplot(diamondsNew, aes(x= carat, y = lresid)) +\ngeom_hex()\nggplot(data = diamondsNew, aes(cut, lresid)) +\ngeom_boxplot()\nggplot(data = diamondsNew, aes(color, lresid)) +\ngeom_boxplot()\nggplot(data = diamondsNew, aes(clarity, lresid)) +\ngeom_boxplot()\nmlm &lt;- lm(lprice ~ lcarat + cut + color + clarity, data = diamondsNew)\ndiamondsNew %&gt;% \ndata_grid(cut, .model = mlm) %&gt;% \nadd_predictions(mlm, \"prevalue\")\n\n# A tibble: 5 × 5\n  cut       lcarat color clarity prevalue\n  &lt;ord&gt;      &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;\n1 Fair      -0.515 G     VS2         11.2\n2 Good      -0.515 G     VS2         11.3\n3 Very Good -0.515 G     VS2         11.4\n4 Premium   -0.515 G     VS2         11.4\n5 Ideal     -0.515 G     VS2         11.4\ndiamondsNew  %&gt;% \ngroup_by(by = clarity)  %&gt;% \nsummarise(nNum = n())\n\n# A tibble: 8 × 2\n  by     nNum\n  &lt;ord&gt; &lt;int&gt;\n1 I1      704\n2 SI2    9105\n3 SI1   13054\n4 VS2   12254\n5 VS1    8169\n6 VVS2   5066\n7 VVS1   3655\n8 IF     1790\ndiamondsNew  %&gt;% \ngroup_by(by = color)  %&gt;% \nsummarise(nNum = n())\n\n# A tibble: 7 × 2\n  by     nNum\n  &lt;ord&gt; &lt;int&gt;\n1 D      6771\n2 E      9792\n3 F      9537\n4 G     11277\n5 H      8264\n6 I      5387\n7 J      2769",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>案例: 钻石数据集分析</span>"
    ]
  },
  {
    "objectID": "case1.html#度量carat与price之间的关系",
    "href": "case1.html#度量carat与price之间的关系",
    "title": "4  案例: 钻石数据集分析",
    "section": "",
    "text": "去噪\n\n\n\n\n\n建立线性回归模型\n\n\n\n\n\n\n\ncut color clarity与残差的关系图\n\n\n\n\n\n\n\n\n连续值用的中位数\n离散值用的是众数?\n考试题",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>案例: 钻石数据集分析</span>"
    ]
  },
  {
    "objectID": "case2.html",
    "href": "case2.html",
    "title": "5  案例: 航班数据集分析",
    "section": "",
    "text": "library(magrittr)\nlibrary(tidyverse)\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.3     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.0\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ tidyr::extract()   masks magrittr::extract()\n✖ dplyr::filter()    masks stats::filter()\n✖ dplyr::lag()       masks stats::lag()\n✖ purrr::set_names() masks magrittr::set_names()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nlibrary(modelr)\n\n\nlibrary(nycflights13)\nhead(flights)\n\n# A tibble: 6 × 19\n   year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time\n  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;\n1  2013     1     1      517            515         2      830            819\n2  2013     1     1      533            529         4      850            830\n3  2013     1     1      542            540         2      923            850\n4  2013     1     1      544            545        -1     1004           1022\n5  2013     1     1      554            600        -6      812            837\n6  2013     1     1      554            558        -4      740            728\n# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,\n#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,\n#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;\n\n\n\nlibrary(lubridate)\nflightsNew &lt;- flights %&gt;% \nmutate(date = make_date(year, month, day))\n\n\ndaily &lt;- flightsNew  %&gt;% \ngroup_by(by = date)  %&gt;% \nsummarise(dayNum = n())\nhead(daily)\n\n# A tibble: 6 × 2\n  by         dayNum\n  &lt;date&gt;      &lt;int&gt;\n1 2013-01-01    842\n2 2013-01-02    943\n3 2013-01-03    914\n4 2013-01-04    915\n5 2013-01-05    720\n6 2013-01-06    832\n\n\n\nggplot(daily, aes(by, dayNum)) +\ngeom_line()\n\n\n\n\n\n\n\n\n\ndailyNew &lt;- daily  %&gt;% \nmutate(week = wday(by,label=TRUE))\n\n\ndailyNewTest &lt;- daily  %&gt;% \nmutate(week = wday(by))\n\n\n为什么会出现一个箱子？（石学成）\n\n\nclass(dailyNewTest$week)\n\n[1] \"numeric\"\n\nggplot(dailyNewTest, aes(week, dayNum)) + \ngeom_boxplot(aes(group=week))\n\n\n\n\n\n\n\n\n\nclass(dailyNew$week)\n\n[1] \"ordered\" \"factor\" \n\np1 &lt;- ggplot(dailyNew, aes(week, dayNum)) + geom_boxplot()\np1\n\n\n\n\n\n\n\n\n\nmod = lm(dayNum~week, data = dailyNew)\nmod\n\n\nCall:\nlm(formula = dayNum ~ week, data = dailyNew)\n\nCoefficients:\n(Intercept)       week.L       week.Q       week.C       week^4       week^5  \n    922.595      -83.322     -155.111      -62.834      -80.126       -4.967  \n     week^6  \n    -16.934  \n\n\n\ngrid &lt;- dailyNew %&gt;%\n  data_grid(week) %&gt;%\n  add_predictions(mod, \"numPred\")\ngrid\n\n# A tibble: 7 × 2\n  week  numPred\n  &lt;ord&gt;   &lt;dbl&gt;\n1 日       891.\n2 一       975.\n3 二       951.\n4 三       963.\n5 四       966.\n6 五       967.\n7 六       745.\n\n\n\np1 + \ngeom_point(data = grid, aes(week, numPred),col=\"red\")\n\n\n\n\n\n\n\n\n\n残差图\n\n\ndailyRes &lt;- dailyNew %&gt;%\n  add_residuals(mod)\n\nggplot(dailyRes, aes(by, resid)) +\n  geom_ref_line(h=0, col = \"red\", size = .2)+\n  geom_line()\n\n\n\n\n\n\n\n\n找到残差比较大的点\n\ndailyRes  %&gt;% \n  arrange(-abs(resid))  \n\n# A tibble: 365 × 4\n   by         dayNum week  resid\n   &lt;date&gt;      &lt;int&gt; &lt;ord&gt; &lt;dbl&gt;\n 1 2013-11-28    634 四    -332.\n 2 2013-11-29    661 五    -306.\n 3 2013-12-25    719 三    -244.\n 4 2013-07-04    737 四    -229.\n 5 2013-12-24    761 二    -190.\n 6 2013-12-31    776 二    -175.\n 7 2013-09-01    718 日    -173.\n 8 2013-05-26    729 日    -162.\n 9 2013-07-05    822 五    -145.\n10 2013-11-30    857 六     112.\n# ℹ 355 more rows\n\nhead(dailyRes)\n\n# A tibble: 6 × 4\n  by         dayNum week   resid\n  &lt;date&gt;      &lt;int&gt; &lt;ord&gt;  &lt;dbl&gt;\n1 2013-01-01    842 二    -109. \n2 2013-01-02    943 三     -19.7\n3 2013-01-03    914 四     -51.7\n4 2013-01-04    915 五     -52.5\n5 2013-01-05    720 六     -24.6\n6 2013-01-06    832 日     -59.5\n\n#filter(abs(resid)&gt;200)",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>案例: 航班数据集分析</span>"
    ]
  },
  {
    "objectID": "hypothesis.html",
    "href": "hypothesis.html",
    "title": "6  假设检验",
    "section": "",
    "text": "6.0.1 第一类错误\n\n拒真概率： 当原假设为真时，检验统计量落入拒绝域的概率 \\[P(X \\in W |H_0=TRUE)\\]\n\\(\\alpha\\)\n\n\n\n6.0.2 第二类错误\n\n取伪概率：当备择假设为真时，检验统计量未落入拒绝域的概率\n\n\\[P(X \\notin W |H_1=TRUE)\\]\n\n\\(\\beta\\)\n假验的效能：正确接受备择假设的概率 \\[(1-\\beta) \\times 100\\%\\]\n\n\n\n6.0.3 \\(p\\)值\n\n\n6.0.4 样本量\n\n效能分析：决定统计学检验的效能和计算揭示一定大小效应所需要的最小样本量\n\n\\(\\alpha\\): 第一类错误概率\n\\(\\beta\\): 第二类错误概率\n\\(d\\): 效应的大小，即所研究的效应相对样本的标准差\\(\\sigma\\)的大小\n\\(n\\): 样本大小\n\n上面四个参数，只要固定三个，就可以确定剩余参数的值",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>假设检验</span>"
    ]
  },
  {
    "objectID": "summary.html",
    "href": "summary.html",
    "title": "7  课程总结",
    "section": "",
    "text": "参考资料(Wickham and Grolemund 2023)\n\n\n\n\nWickham, Çetinkaya-Rundel, Hadley, and Garrett Grolemund. 2023. R for Data Science: Import, Tidy, Transform, Visualize, and Model Data. R for Data Science: Import, Tidy, Transform, Visualize,; Model Data.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>课程总结</span>"
    ]
  },
  {
    "objectID": "references.html",
    "href": "references.html",
    "title": "参考资料",
    "section": "",
    "text": "Wickham, Çetinkaya-Rundel, Hadley, and Garrett Grolemund. 2023. R\nfor Data Science: Import, Tidy, Transform, Visualize, and Model\nData. R for Data Science: Import, Tidy, Transform, Visualize,;\nModel Data.",
    "crumbs": [
      "参考资料"
    ]
  }
]